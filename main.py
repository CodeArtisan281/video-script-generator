import streamlit as st
from utils import generate_script

# ç»™ç½‘ç«™å†™ä¸€ä¸ªæ ‡é¢˜
st.header('ğŸ¬ çŸ­è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨')
st.write('##### psï¼šğŸ«ğŸ„â€â™‚ï¸ğŸ ä½¿ç”¨è¦äº¤ç‰ˆæƒè´¹ğŸ˜')

# åˆ›å»ºä¸€ä¸ªä¾§è¾¹æ 
with st.sidebar:
    # ä¾§è¾¹æ ä¸­è¦è®©ç”¨æˆ·è¾“å…¥è‡ªå·±çš„apiç§˜é’¥ï¼Œå¹¶æ‰ç”¨å¯†ç çš„å½¢å¼å±•ç¤º
    api_key = st.text_input('è¯·è¾“å…¥OpenAIç§˜é’¥ï¼š',type='password')
    # ä¾§è¾¹æ ä¸­è¦è®©ç”¨æˆ·è¾“å…¥apiæ¥å£ç½‘å€
    base_url = st.text_input('è¯·è¾“å…¥æ‚¨çš„API_Keyçš„æ¥å£ç½‘å€')
    # ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªè·å–OpenAIå®˜æ–¹çš„APIå®˜æ–¹ç½‘å€
    st.markdown('[è·å–OpenAI APIå®˜æ–¹ç§˜é’¥ï¼ˆéœ€è¦ç§‘å­¦ä¸Šç½‘ï¼‰](https://platform.openai.com/account/api-keys)')
    # ç»™ç”¨æˆ·æä¾›ä¸€ä¸ªè·å–ä¸­è½¬APIç½‘å€ï¼Œä½¿å›½å†…ç”¨æˆ·ä¹Ÿèƒ½å¤Ÿé€šè¿‡ä¸­è½¬APIä½¿ç”¨åˆ°GPT
    st.markdown('[è·å–ä¸­è½¬APIç§˜é’¥ï¼ˆå›½å†…å¯ç”¨ï¼Œæ¨èè¿™ä¸ªï¼‰](https://api.aigc369.com/)')

# åˆ›å»ºä¸€ä¸ªè§†é¢‘ä¸»é¢˜çš„è¾“å…¥æ¡†
subject = st.text_input('ğŸ’¡ è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜')

# åˆ›å»ºä¸€ä¸ªè§†é¢‘æ—¶é•¿çš„æ•°å­—è¾“å…¥æ¡†
video_length = st.number_input('â±ï¸ è¯·è¾“å…¥è§†é¢‘çš„å¤§è‡´æ—¶é•¿ï¼ˆå•ä½ï¼šåˆ†é’Ÿï¼‰',min_value=0.1,step=0.1)

# åˆ›å»ºä¸€ä¸ªåˆ›é€ æ€§çš„å‚æ•°æ»‘å—
creativity = st.slider('âœ¨ è¯·è¾“å…¥è§†é¢‘è„šæœ¬çš„åˆ›é€ åŠ›ï¼ˆæ•°å­—å°è¯´æ˜æ›´ä¸¥è°¨ï¼Œæ•°å­—å¤§è¯´æ˜æ›´å¤šæ ·)',
                       min_value=0.0,
                       max_value=1.0,
                       step=0.1,
                       value=0.7)

# åˆ›å»ºä¸€ä¸ªç”Ÿæˆè„šæœ¬çš„æŒ‰é’®
submit = st.button('ç”Ÿæˆè„šæœ¬')

# ç”¨æˆ·æŒ‰æŒ‰é’®å‰è‹¥æ²¡è¾“å…¥APIç§˜é’¥æç¤ºç”¨æˆ·è¾“å…¥APIç§˜é’¥æ‰èƒ½ç”Ÿæˆè„šæœ¬
if submit and not api_key:
    st.info('è¯·è¾“å…¥æ‚¨çš„OpenAI APIç§˜é’¥')    # æç¤ºç”¨æˆ·è¾“å…¥APIç§˜é’¥
    st.stop()   # ç”¨stopå‡½æ•°ç½‘é¡µå°†ä¸å†è¿è¡Œä¸‹é¢çš„ä»£ç 

# ç”¨æˆ·æŒ‰æŒ‰é’®å‰è‹¥æ²¡è¾“å…¥APIæ¥å£ç½‘å€æç¤ºç”¨æˆ·è¾“å…¥APIæ¥å£ç½‘å€æ‰èƒ½ç”Ÿæˆè„šæœ¬
if submit and not base_url:
    st.info('è¯·è¾“å…¥æ‚¨çš„OpenAI APIæ¥å£ç½‘å€')  # æç¤ºç”¨æˆ·è¾“å…¥APIæ¥å£ç½‘å€
    st.stop()   # ç”¨stopå‡½æ•°ç½‘é¡µå°†ä¸å†è¿è¡Œä¸‹é¢çš„ä»£ç 

# ç”¨æˆ·æŒ‰æŒ‰é’®å‰è‹¥æ²¡è¾“å…¥è§†é¢‘ä¸»é¢˜æç¤ºç”¨æˆ·è¾“å…¥è§†é¢‘ä¸»é¢˜æ‰èƒ½ç”Ÿæˆè„šæœ¬
if submit and not subject:
    st.info('è¯·è¾“å…¥è§†é¢‘çš„ä¸»é¢˜')     # æç¤ºç”¨æˆ·è¾“å…¥è§†é¢‘ä¸»é¢˜
    st.stop()   # ç”¨stopå‡½æ•°ç½‘é¡µå°†ä¸å†è¿è¡Œä¸‹é¢çš„ä»£ç 

# æœ€åå½“ç”¨æˆ·å…¨éƒ½è¾“å…¥å¥½æŒ‰ä¸‹æŒ‰é’®æ—¶
if submit:
    # åˆ›å»ºä¸€ä¸ªåŠ è½½ä¸­çš„å°æç¤º
    with st.spinner('AIæ­£åœ¨æ€è€ƒä¸­ï¼Œå¯ä»¥å…ˆå»æ•²æ•²ğŸ«ğŸ„â€â™‚ï¸ğŸ çš„è„‘ç“œå­ğŸ¤ª'):
        # å°†åŠ è½½ä¸­è¾ƒæ…¢çš„ä»£ç æ”¾è¿›æ¥
        title,script,search_result = generate_script(subject,video_length,api_key,base_url,creativity)

    # è‹¥ä»£ç ç”ŸæˆæˆåŠŸåç»™ä¸€ä¸ªå°æç¤º
    st.success('è§†é¢‘è„šæœ¬å·²ç”Ÿæˆï¼')

    # æ”¾å…¥ç”Ÿæˆç¬¬ä¸€åˆ—å†…å®¹çš„æ ‡é¢˜
    st.subheader('ğŸ”¥ æ ‡é¢˜ï¼š')

    # å°†AIç”Ÿæˆçš„æ ‡é¢˜å±•ç¤ºä¸Šå»
    st.write(title)

    # æ”¾å…¥ç”Ÿæˆç¬¬äºŒåˆ—å†…å®¹çš„æ ‡é¢˜
    st.subheader('ğŸ“ è§†é¢‘è„šæœ¬ï¼š')

    # å°†AIç”Ÿæˆçš„æ ‡é¢˜å±•ç¤ºä¸Šå»
    st.write(script)

    # æ”¾å…¥ä¸€ä¸ªæœç´¢éšè—ä¸‹æ‹‰æ¡†
    with st.expander('ç»´åŸºç™¾ç§‘æœç´¢ç»“æœ ğŸ‘€'):
        st.info(search_result)  # å±•ç¤ºç»´åŸºç™¾ç§‘çš„æœç´¢ç»“æœ